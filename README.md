# Telegraph å›¾åºŠ

åŸºäº Cloudflare Workers å’Œ Pages çš„å›¾åºŠæœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ä¸€é”®å¤åˆ¶é“¾æ¥
- æœ¬åœ°ä¸Šä¼ å†å²è®°å½•
- å¯é€‰çš„è®¿å®¢éªŒè¯åŠŸèƒ½
- å•æ–‡ä»¶æœ€å¤§æ”¯æŒ 20MB
- æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ å’Œç²˜è´´ä¸Šä¼ 
- æ”¯æŒæ‰¹é‡æ“ä½œå’Œæ˜¾ç¤ºä¸Šä¼ æ—¶é—´
- å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ï¼ˆGIFå’Œè§†é¢‘é™¤å¤–ï¼‰
- Cloudflare Cache API ç¼“å­˜æ”¯æŒ
- åŸºäº Telegram Bot API çš„æ–‡ä»¶å­˜å‚¨
- æ”¯æŒå¤šç§é“¾æ¥æ ¼å¼ï¼ˆURLã€BBCodeã€Markdownï¼‰
- æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼ï¼ˆjpgã€pngã€gifã€mp4ï¼‰

## æ›´æ–°æ—¥å¿—

> **æœ€è¿‘æ›´æ–°**: 2024-12-4
> - ä¿®å¤ç²˜è´´ä¸Šä¼ æ—¶ï¼Œé‡å¤ä¸Šä¼ å›¾ç‰‡çš„é—®é¢˜

<details>
<summary>å†å²æ›´æ–°è®°å½•</summary>

### 2024-12-4
- ä¿®å¤ç²˜è´´ä¸Šä¼ æ—¶ï¼Œé‡å¤ä¸Šä¼ å›¾ç‰‡çš„é—®é¢˜

### 2024-11-29
#### ç®¡ç†é¡µé¢
- æ–°å¢å…¨é€‰å’Œå¤åˆ¶åŠŸèƒ½
- åˆ é™¤å‰è¿›è¡ŒäºŒæ¬¡ç¡®è®¤
- ä¼˜åŒ–èµ„æºåŠ è½½é€»è¾‘
- ç¦ç”¨è§†é¢‘æ–‡ä»¶è‡ªåŠ¨æ’­æ”¾
#### é¦–é¡µ
- ä¿®å¤ç²˜è´´ä¸Šä¼ æ—¶ä¸æ˜¾ç¤ºç§»é™¤æŒ‰é’®çš„é—®é¢˜

### 2024-11-21æ—¥
- ä¼˜åŒ–ä¸Šä¼ ä½“éªŒï¼Œé»˜è®¤å¼€å¯å‹ç¼©ï¼ŒåŠ å¿«æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦
  - å¦‚éœ€å…³é—­ï¼Œè¯·å°†ä»£ç çš„238è¡Œä¿®æ”¹ä¸º```enableCompression: false```

### 2024-11-01
- ä¿®å¤ä¸Šä¼ åæ— æ³•åŠ è½½çš„é—®é¢˜

### 2024-10-19
- ä¿®å¤webpæ— æ³•ä¸Šä¼ çš„BUG
- ä¼˜åŒ–æ•°æ®åº“ç»“æ„ï¼Œ[æŸ¥çœ‹è¿ç§»æ•™ç¨‹](https://github.com/0-RTT/telegraph/releases/tag/v2.0)

### 2024-09-29
- ä¼˜åŒ–ç¼“å­˜åŠŸèƒ½ï¼Œé‡‡ç”¨ Cloudflare Cache API ç¼“å­˜æ”¯æŒ

### 2024-09-25
- ä¿®å¤GIFæ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜ï¼Œæ„Ÿè°¢ [nodeseek](https://www.nodeseek.com/) ç”¨æˆ· [@Libs](https://www.nodeseek.com/space/7214#/general) æä¾›çš„æ€è·¯
- Telegraphæ¥å£ç§»åˆ°äº†telegraphåˆ†æ”¯ï¼Œmainåˆ†æ”¯ä¸ºTG_BOTæ¥å£ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥forkä»“åº“éƒ¨ç½²åˆ°pages

### 2024-09-23
- ä¿®å¤é“¾æ¥å¤±æ•ˆçš„é—®é¢˜ï¼Œæ”¯æŒè§†é¢‘æ–‡ä»¶ä¸Šä¼ 

### 2024-09-14
- Telegraphæ¥å£ä¸Šä¼ çš„æ–‡ä»¶æœ‰**æ—¶æ•ˆæ€§**ï¼Œå»ºè®®ä½¿ç”¨TG_BOTä¸Šä¼ 

### 2024-09-13
- æ”¯æŒé€šè¿‡TG_BOTä¸Šä¼ åˆ°é¢‘é“

### 2024-09-12
- å·²ä¿®å¤ï¼Œå¯æ­£å¸¸ä¸Šä¼ åˆ°telegraph

### 2024-09-06
> ~~2024å¹´9æœˆ6æ—¥èµ· telegra.ph ç¦æ­¢äº†ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼Œæ­¤é¡¹ç›®ç»ˆç»“ã€‚~~

</details>

## éƒ¨ç½²æ­¥éª¤

### 1. ç¯å¢ƒå˜é‡è¯´æ˜
éœ€è¦åœ¨ Cloudflare Workers ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡:

| å˜é‡å | è¯´æ˜ | å¿…å¡« | ç¤ºä¾‹ |
|--------|------|------|------|
| DOMAIN | è‡ªå®šä¹‰åŸŸå | æ˜¯ | example.workers.dev |
| DATABASE | D1 æ•°æ®åº“ç»‘å®šå˜é‡åç§° | æ˜¯ | DATABASE |
| TG_BOT_TOKEN | Telegram Bot Token | æ˜¯ | 123456789:ABCdefGHIjklMNOpqrsTUVwxyz |
| TG_CHAT_ID | Telegram é¢‘é“/ç¾¤ç»„ ID | æ˜¯ | -100xxxxxxxxxx |
| USERNAME | ç®¡ç†å‘˜ç”¨æˆ·å | æ˜¯ | admin |
| PASSWORD | ç®¡ç†å‘˜å¯†ç  | æ˜¯ | password123 |
| ADMIN_PATH | ç®¡ç†åå°è·¯å¾„ | æ˜¯ | admin |
| ENABLE_AUTH | è®¿å®¢éªŒè¯ï¼ˆè®¾ç½®ä¸º true å¼€å¯ï¼Œä¸è®¾ç½®æˆ–è®¾ç½®ä¸º false åˆ™å…³é—­ï¼‰ | å¦ | false |

### 2. åˆ›å»º Telegram Bot
1. åœ¨ Telegram ä¸­æ‰¾åˆ° [@BotFather](https://t.me/BotFather)
2. å‘é€ `/newbot` å‘½ä»¤åˆ›å»ºæ–°æœºå™¨äºº
3. æŒ‰ç…§æç¤ºè®¾ç½®æœºå™¨äººåå’Œç”¨æˆ·å
4. ä¿å­˜è·å¾—çš„ Bot Token (æ ¼å¼ä¸º`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
   - è¿™ä¸ª Token å°†ç”¨ä½œç¯å¢ƒå˜é‡ `TG_BOT_TOKEN`

### 3. åˆ›å»º Telegram é¢‘é“æˆ–ç¾¤ç»„
1. åˆ›å»ºä¸€ä¸ªæ–°çš„é¢‘é“æˆ–ç¾¤ç»„
2. å°†ä½ çš„ Bot æ·»åŠ ä¸ºç®¡ç†å‘˜
3. è·å–é¢‘é“/ç¾¤ç»„ IDï¼š
   - å‘é€é¢‘é“å†…çš„ä»»æ„æ¶ˆæ¯ç»™ [@getidsbot](https://t.me/getidsbot)
   - åœ¨ Origin chat ä¸‹æ‰¾åˆ°å¯¹åº”çš„ ID (æ ¼å¼ä¸º `-100xxxxxxxxxx`)
   - è¿™ä¸ª ID å°†ç”¨ä½œç¯å¢ƒå˜é‡ `TG_CHAT_ID`

### 4. åˆ›å»º D1 æ•°æ®åº“
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ `Workers & Pages` â†’ `D1 SQL æ•°æ®åº“`
3. ç‚¹å‡» `åˆ›å»º` åˆ›å»ºæ•°æ®åº“
   - æ•°æ®åº“åç§°å¯è‡ªå®šä¹‰ï¼Œä¾‹å¦‚`images`
   - å»ºè®®é€‰æ‹©æ•°æ®åº“ä½ç½®ä¸º `äºšå¤ªåœ°åŒº`ï¼Œå¯ä»¥è·å¾—æ›´å¥½çš„è®¿é—®é€Ÿåº¦
4. åˆ›å»ºæ•°æ®è¡¨:
   - ç‚¹å‡»æ•°æ®åº“åç§°è¿›å…¥è¯¦æƒ…é¡µ
   - é€‰æ‹© `æ§åˆ¶å°` æ ‡ç­¾
   - æ‰§è¡Œä¸‹ SQL è¯­å¥:
```sql
CREATE TABLE media (
    url TEXT PRIMARY KEY,
    fileId TEXT NOT NULL
);
```

### 5. åˆ›å»º Worker
1. è¿›å…¥ `Workers & Pages`
2. ç‚¹å‡» `åˆ›å»º`
3. é€‰æ‹© `åˆ›å»º Worker`
4. ä¸º Worker è®¾ç½®ä¸€ä¸ªåç§°
5. ç‚¹å‡» `éƒ¨ç½²` åˆ›å»º Worker
6. ç‚¹å‡»ç»§ç»­å¤„ç†é¡¹ç›®

### 6. é…ç½®ç¯å¢ƒå˜é‡
1. åœ¨ Worker çš„ `è®¾ç½®` â†’ `å˜é‡å’Œæœºå¯†` ä¸­
2. ç‚¹å‡» `æ·»åŠ ` æ·»åŠ å˜é‡
3. ç‚¹å‡» `éƒ¨ç½²`

### 7. ç»‘å®šæ•°æ®åº“
1. åœ¨ Worker è®¾ç½®é¡µé¢æ‰¾åˆ° `è®¾ç½®` â†’ `ç»‘å®š`
2. ç‚¹å‡» `æ·»åŠ `
3. é€‰æ‹© `D1æ•°æ®åº“`
4. è®¾ç½®å˜é‡åä¸º `DATABASE`
5. é€‰æ‹©ä¹‹å‰åˆ›å»ºçš„æ•°æ®åº“
6. ç‚¹å‡» `éƒ¨ç½²`

### 8. ç»‘å®šåŸŸå
1. åœ¨ Worker çš„ `è®¾ç½®` â†’ `åŸŸå’Œè·¯ç”±`
2. ç‚¹å‡» `æ·»åŠ ` â†’ `è‡ªå®šä¹‰åŸŸ`
3. è¾“å…¥ä½ åœ¨Cloudflareç»‘å®šçš„åŸŸå
4. ç‚¹å‡» `æ·»åŠ åŸŸ`
5. ç­‰å¾…åŸŸåç”Ÿæ•ˆ

### 9. éƒ¨ç½²ä»£ç 
1. è¿›å…¥ Worker çš„ç¼–è¾‘é¡µé¢
2. å°† `_worker.js` çš„å®Œæ•´ä»£ç å¤åˆ¶ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­
3. ç‚¹å‡» `éƒ¨ç½²`

## éƒ¨ç½²æ­¥éª¤å‚è€ƒï¼š

> âš ï¸ ä»¥ä¸‹å›¾ç‰‡é‡Œçš„ä»…ä¾›å‚è€ƒï¼ŒCloudflare é¢æ¿å¯èƒ½ä¼šæ›´æ–°ï¼Œå…·ä½“æ“ä½œè¯·ä»¥ä¸Šæ–¹æ–‡å­—æ•™ç¨‹ä¸ºå‡†ã€‚

> ğŸ’¡å¦å¤–å¯ä»¥å‚è€ƒ nodeseekç”¨æˆ·@sdo888çš„[å›¾æ–‡æ•™ç¨‹](https://www.nodeseek.com/post-196832-1)

### Worker éƒ¨ç½²ç¤ºä¾‹

#### 1ã€åˆå§‹åŒ–æ•°æ®åº“
![image](https://kycloud3.koyoo.cn/20241007ae0fa202410070917194587.png)  

![image](https://kycloud3.koyoo.cn/202410074b824202410070851275140.png)  
 
![image](https://kycloud3.koyoo.cn/20241007917fa202410070852019143.png)  
 
![image](https://kycloud3.koyoo.cn/20240829426e2202408291111415611.png)  

![image](https://kycloud3.koyoo.cn/202408290028f20240829111205448.png)  

#### 2ã€åˆ›å»ºworker
![image](https://kycloud3.koyoo.cn/202408295c74a202408291112222566.png)

![image](https://kycloud3.koyoo.cn/20240829b4a21202408291118209822.png)

#### 3ã€è®¾ç½®è‡ªå®šä¹‰åŸŸå
![image](https://kycloud3.koyoo.cn/20240829d5fe4202408291113048235.png)

![image](https://kycloud3.koyoo.cn/20240829f9ecc202408291113197734.png)

![image](https://kycloud3.koyoo.cn/2024082997a84202408291113394516.png)

![image](https://kycloud3.koyoo.cn/202408294223e202408291114234528.png)

![image](https://kycloud3.koyoo.cn/202408294def5202408291113564340.png)

#### 4ã€è®¾ç½®å˜é‡
![image](https://kycloud3.koyoo.cn/2024092389dc0202409232021524424.png) 

#### 5ã€å°†_worker.jsä¸­çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­
![image](https://kycloud3.koyoo.cn/202408299f1cf202408291115372291.png)

![image](https://kycloud3.koyoo.cn/2024082995808202408291115555979.png)

#### 6ã€ç‚¹å‡»éƒ¨ç½²å³å¯
![image](https://kycloud3.koyoo.cn/20240829a4d5f202408291117024227.png)

## Pageséƒ¨ç½²æ•™ç¨‹ï¼š

#### 1ã€åˆå§‹åŒ–æ•°æ®åº“
![image](https://kycloud3.koyoo.cn/20241007ae0fa202410070917194587.png)  

![image](https://kycloud3.koyoo.cn/202410074b824202410070851275140.png)  
 
![image](https://kycloud3.koyoo.cn/20241007917fa202410070852019143.png)  
 
![image](https://kycloud3.koyoo.cn/20240829426e2202408291111415611.png)  

![image](https://kycloud3.koyoo.cn/202408290028f20240829111205448.png)  

#### 2ã€éƒ¨ç½²åˆ°pages

![image](https://kycloud3.koyoo.cn/20241007f786a202410070857578208.png)

- 2.1 ä¸‹è½½_worker.jsï¼Œæ‰“åŒ…æˆzipä¸Šä¼ åˆ°pages

![image](https://kycloud3.koyoo.cn/2024100790232202410070900405992.png)

- 2.2 é€šè¿‡forkæœ¬ä»“åº“éƒ¨ç½²åˆ°pages
![image](https://kycloud3.koyoo.cn/20241007d7bf6202410070902287155.png)
![image](https://kycloud3.koyoo.cn/20241007a4b2f202410070902288891.png)

#### 3ã€è®¾ç½®å˜é‡
![image](https://kycloud3.koyoo.cn/2024092389dc0202409232021524424.png) 

#### 4ã€è®¾ç½®è‡ªå®šä¹‰åŸŸåã€‚
![image](https://kycloud3.koyoo.cn/202409068f76a202409061718122696.png)  

![image](https://kycloud3.koyoo.cn/20240906b79a6202409061719043430.png)  

![image](https://kycloud3.koyoo.cn/20240906188f8202409061720032928.png)  

#### 5ã€é‡æ–°éƒ¨ç½²ç”Ÿæ•ˆåˆšåˆšé…ç½®çš„è‡ªå®šä¹‰åŸŸåå’Œå˜é‡

![image](https://kycloud3.koyoo.cn/202409066761e202409061721281588.png)  

![image](https://kycloud3.koyoo.cn/2024090677f2320240906172317323.png)  

![image](https://kycloud3.koyoo.cn/202409065c29920240906172451915.png)  

## å¼€æºåè®®

MIT License

## é¸£è°¢

- [Cloudflare](https://www.cloudflare.com/)
- [Telegram](https://telegram.org/)
